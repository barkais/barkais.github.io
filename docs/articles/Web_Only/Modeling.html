<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="moleculaR">
<title>Modeling • moleculaR</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Modeling">
<meta property="og:description" content="moleculaR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../../index.html">moleculaR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../../articles/Web_Only/Command_Line_Usage.html">Command Line Usage</a>
    <a class="dropdown-item" href="../../articles/Web_Only/Cube_Functions.html">Cube Functions</a>
    <a class="dropdown-item" href="../../articles/Web_Only/Getting_Started_with_Examples.html">Getting Started with Examples</a>
    <a class="dropdown-item" href="../../articles/Web_Only/Modeling.html">Modeling</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Modeling</h1>
            
      
      
      <div class="d-none name"><code>Modeling.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">moleculaR</span><span class="op">)</span></span></code></pre></div>
<hr>
<p>moleculaR offers a few easy-to-use and useful functionalities for the
development and visualization of structure-activity relationship
models</p>
<blockquote>
<p><strong>This guide includes examples for both linear regressions and
logistic regressions.</strong></p>
<p><strong>For both parts, it first introduces the underlying mechanics,
which are followed by the main user functions -
<code><a href="../../reference/model.report.html">model.report()</a></code> and <code><a href="../../reference/model.report.logistic.html">model.report.logistic()</a></code> /
<code><a href="../../reference/model.report.log.ordinal.html">model.report.log.ordinal()</a></code>.</strong></p>
</blockquote>
<p>Please find the <a href="https://github.com/barkais/moleculaR/blob/main/Modeling/Linear_Dataset_Example.csv" class="external-link">linear
regression</a> <sup>[1]</sup> and the <a href="https://github.com/barkais/moleculaR/blob/main/Modeling/Logistic_Dataset_Example.csv" class="external-link">logistic
regression</a> <sup>[2]</sup> example data sets on the package’s
Github</p>
<hr>
<div class="section level2">
<h2 id="linear-regressions">Linear Regressions<a class="anchor" aria-label="anchor" href="#linear-regressions"></a>
</h2>
<blockquote>
<p><strong>Before you begin, check out the example data and its
structure. Especially note the ‘output’ column. This is exactly how any
data fed into the following functions should look like.</strong></p>
</blockquote>
<div class="section level3">
<h3 id="feature-subsets-and-model-ranking">Feature Subsets and Model Ranking<a class="anchor" aria-label="anchor" href="#feature-subsets-and-model-ranking"></a>
</h3>
<p><code>model.subsets()</code> presents a brute force feature selection
algorithm, based on a K-fold cross validation Q<sup>2</sup> ranking. It
computes all possible models with a user defined range of features,
returning the top ranking models.</p>
<p>To use the function, data must be a numeric data frame that is loaded
into the global environment (data argument). Data must also have the
<strong>last</strong> column holding the experimental observations (this
is crucial for a smooth work experience).</p>
<p>For a minimal case usage, with no changes made to defaults -
<code><a href="../../reference/model.subset.html">model.subset()</a></code> will search for all possible models with 2
variables and up to the number of samples divided by 5. It will then
retain models with R<sup>2</sup> above the <code>cutoff</code> (If there
are any. If not, it will lower the cutoff down.) and pass them through a
<code>folds</code> CV, which defaults to leave-one-out. The cross terms
option adds all <code>:</code> interactions between variables - it is
highly recommended to avoid it in cases with a lot of variables.</p>
<pre><code><span><span class="co">### Function structure ###</span></span>
<span></span>
<span><span class="fu"><a href="../../reference/model.subset.html">model.subset</a></span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  out.col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>  min <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>  folds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>,</span>
<span>  iterations <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="fl">0.85</span>,</span>
<span>  cross.terms <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span></span></code></pre>
<p>In R or RStudio console:</p>
<pre><code><span><span class="co">### Minimal (default) usage ###</span></span>
<span></span>
<span><span class="co"># Load data</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="st">'path/to/downloaded/Linear_Dataset_Example.csv'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assuming the first column of data is molecule names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Remove after assigning row names</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Run model.subset</span></span>
<span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/model.subset.html">model.subset</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span></code></pre>
<p>This returns all models above R<sup>2</sup> = 0.85:</p>
<p>Note the assignment of results to a variable named ‘models’, which is
recommended for later use of <code><a href="../../reference/model.plot.html">model.plot()</a></code>.</p>
<pre><code>models
                                               formula      R.sq      Q.sq        MAE Model
1      `output` ~ `Dist.10..17.` + `Total` + `NBO.B.2` 0.9183105 0.8638877 0.06189765     1
2   `output` ~ `Total` + `diff.B2.O9` + `diff.H10.O17` 0.8805636 0.8076407 0.07157056     2
3 `output` ~ `Dist.16..17.` + `Total` + `diff.H16.O17` 0.9020966 0.7913756 0.07490688     3
4 `output` ~ `Dist.10..17.` + `Total` + `diff.H16.O17` 0.8606321 0.7632980 0.08346307     4</code></pre>
<p><strong>Don’t be startled by the warning, which is due to a small
number of observations in this specific data</strong></p>
</div>
<div class="section level3">
<h3 id="model-plot">Model Plot<a class="anchor" aria-label="anchor" href="#model-plot"></a>
</h3>
<p>To produce a nice, yet minimal plot of the linear model, with
predicted values vs. measured ones, use <code><a href="../../reference/model.plot.html">model.plot()</a></code>.
Assuming the user saved <code><a href="../../reference/model.subset.html">model.subset()</a></code>s result with
‘models’, <code><a href="../../reference/model.plot.html">model.plot()</a></code> will default to plot the highest
ranking model.</p>
<pre><code><span><span class="co">### Function Structure ###</span></span>
<span><span class="fu"><a href="../../reference/model.plot.html">model.plot</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">models</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">data</span><span class="op">)</span></span></code></pre>
<p>In R or RStudio console:</p>
<pre><code><span><span class="co"># Produce plot (default)</span></span>
<span><span class="fu"><a href="../../reference/model.plot.html">model.plot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span></code></pre>
<p>The names (the first column) in the data have a clear indication of
substituent location on a ring, which is as follows</p>
<ul>
<li>o_ for 2 and 6 substituted rings</li>
<li>m_ for 3 and 5 substituted rings</li>
<li>p_ for 4 substituted rings</li>
<li>oo_for 2,6 substituted rings and mm_ for 3,5 substituted rings</li>
<li>om_ / op_ / mp_ for 2,3 / 2,4 / 3,4 substituted rings</li>
<li>In any other case, it is advised to avoid the naming system, and
stick with the default grey color</li>
</ul>
<p>This is useful in cases where the changing substitution pattern
involves a ring (which are very common). The function translates these,
and indicates them with color - red being ortho, yellow being meta and
green being para.</p>
<p>The plot also includes a prediction band, marked as dotted blue
lines.</p>
<p>The resulting plot:</p>
<center>
<img src="../../reference/figures/model_plot_example.png" width="500" height="428">
</center>
</div>
<div class="section level3">
<h3 id="model-report">Model Report<a class="anchor" aria-label="anchor" href="#model-report"></a>
</h3>
<p><strong>Designed as the main function for linear modeling
purposes.</strong></p>
<p>Produce a complete report for a data set (csv file), and a chosen
model.</p>
<p>This is a wrapper function that uses both <code><a href="../../reference/model.subset.html">model.subset()</a></code>
and <code><a href="../../reference/model.plot.html">model.plot()</a></code> under the hood, which also includes a 3
and 5 fold CV, as well as a LOOCV. The function also adds the model
formula and stats to the plot.</p>
<p>In addition to default usage, the function also allows for outliers
handling and out-of-sample predictions to be considered. To do so, users
should indicate the names of sample as they appear in the original data
(e.g. ‘p_F’ or c(‘p_F’, ‘m_Me’)) in the <code>leave.out</code> argument.
By indicating <code>predict</code> as <code>TRUE</code>, they will be
treated as out-of-sample predictions.</p>
<pre><code><span><span class="co">### Function Structure ###</span></span>
<span><span class="fu"><a href="../../reference/model.report.html">model.report</a></span><span class="op">(</span></span>
<span>  <span class="va">dataset</span>,</span>
<span>  min <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">mod_data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>  leave.out <span class="op">=</span> <span class="st">""</span>,</span>
<span>  predict <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span></span></code></pre>
<p>Normal usgae, for our example file:</p>
<pre><code><span><span class="fu"><a href="../../reference/model.report.html">model.report</a></span><span class="op">(</span><span class="st">'path/to/Linear_Example_Dataset.csv'</span>,</span>
<span>             min <span class="op">=</span> <span class="fl">3</span>,</span>
<span>             max <span class="op">=</span> <span class="fl">3</span>,</span>
<span>             leave.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'p_F'</span>, <span class="st">'m_Me'</span><span class="op">)</span>,</span>
<span>             predict <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre>
<p>First produces <code><a href="../../reference/model.subset.html">model.subset()</a></code> results, and prompts for
the model (number) you wish to plot and report.</p>
<ul>
<li>showing only the 4 top ranked</li>
</ul>
<pre><code>Linear_Example_Dataset

|formula                                              |      R.sq|      Q.sq|       MAE| Model|
|:----------------------------------------------------|---------:|---------:|---------:|-----:|
|`output` ~ `Dist.10..17.` + `Total` + `NBO.B.2`      | 0.9580530| 0.9183570| 0.0514160|     1|
|`output` ~ `Total` + `diff.B2.O9` + `diff.H10.O17`   | 0.9063088| 0.8424013| 0.0692448|     2|
|`output` ~ `Dist.16..17.` + `Total` + `diff.H16.O17` | 0.9244792| 0.8252764| 0.0720359|     3|
|`output` ~ `Dist.10..17.` + `Total` + `diff.H16.O17` | 0.8987248| 0.7797936| 0.0777995|     4|
</code></pre>
<p>After answering the prompt ‘1’ (in the console):</p>
<ul>
<li>Note the out-of-sample (OOS) result</li>
</ul>
<pre><code>Choose the model you would like to plot (line number): 1

  Model Coefficients

|             |   Estimate| Std. Error|    t value|  p value|
|:------------|----------:|----------:|----------:|--------:|
|(Intercept)  |  0.7753622|  0.0144429|  53.684790| 0.00e+00|
|Dist.10..17. | -0.2669203|  0.0191554| -13.934442| 2.00e-07|
|Total        | -0.1902052|  0.0184609| -10.303131| 2.80e-06|
|NBO.B.2      | -0.1303210|  0.0155032|  -8.406052| 1.49e-05|

  3-fold CV

|        Q2|       MAE|
|---------:|---------:|
| 0.8651927| 0.0721472|

  5-fold CV

|        Q2|       MAE|
|---------:|---------:|
| 0.9002753| 0.0582111|


|     |  OOS Pred| OOS Measured|
|:----|---------:|------------:|
|m_Me | 0.8609255|    0.7118072|
|p_F  | 0.9067790|    0.8293038|

  Unnormalized Data Model Coefficients

|             |     Estimate| Std. Error|    t value|  p value|
|:------------|------------:|----------:|----------:|--------:|
|(Intercept)  |  152.3573140| 19.8007301|   7.694530| 9.40e-06|
|Dist.10..17. |  -10.2407833|  0.9469590| -10.814390| 3.00e-07|
|Total        |   -0.1835649|  0.0229566|  -7.996163| 6.60e-06|
|NBO.B.2      | -108.4088125| 16.3732877|  -6.621078| 3.76e-05|</code></pre>
<p>And the produced plot:</p>
<center>
<img src="../../reference/figures/model_report_example.png" width="500" height="428">
</center>
</div>
</div>
<div class="section level2">
<h2 id="logistic-regressions">Logistic Regressions<a class="anchor" aria-label="anchor" href="#logistic-regressions"></a>
</h2>
<blockquote>
<p><strong>Before you begin, check out the example data and its
structure. Especially note the ‘flag’ and ‘class’ columns. This is
exactly how any data fed into the following functions should look
like.</strong></p>
</blockquote>
<p>moleculaR comes with two applicable routs for classifications tasks
using logistic regressions:</p>
<ul>
<li>Multinomial Logistic Regression (MLR)</li>
<li>Ordinal Multinomial Logistic regression (OMLR)</li>
</ul>
<p><strong>This guide will use OMLR as an example. All methods presented
using the <code>.log.ordinal</code> functions family have a parallel
<code>.logistic</code> function. </strong></p>
<div class="section level3">
<h3 id="feature-subsets-and-model-rankings">Feature Subsets and Model Rankings<a class="anchor" aria-label="anchor" href="#feature-subsets-and-model-rankings"></a>
</h3>
<p>Similarly to <code><a href="../../reference/model.subset.html">model.subset()</a></code> used in linear modeling,
classification models are screened and ranked using the
<code><a href="../../reference/model.subset.log.ordinal.html">model.subset.log.ordinal()</a></code> and
<code><a href="../../reference/model.subset.logistic.html">model.subset.logistic()</a></code> functions.</p>
<p>To use the function, data must be a numeric data frame that is loaded
into the global environment (data argument). Data must also have the a
column holding the experimental observations (i.e. classes), that should
be named ‘class’ (this is crucial for a smooth work experience). The
data should also have a column named ‘flag’, which holds the sample
number in the data (basically a row number). This is a must.</p>
<p>For a minimal case usage, with no changes made to defaults -
<code><a href="../../reference/model.subset.log.ordinal.html">model.subset.log.ordinal()</a></code> will search for all possible
models with 2 variables and up to the number of samples divided by 5. It
will then rank the models according to their McFadden pseudo
R<sup>2</sup><sup>[3]</sup>.</p>
<pre><code><span><span class="co">### Function structure ###</span></span>
<span></span>
<span><span class="fu"><a href="../../reference/model.subset.log.ordinal.html">model.subset.log.ordinal</a></span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  out.col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="st">"class"</span><span class="op">)</span>,</span>
<span>  min <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
<p>In R or RStudio console:</p>
<pre><code><span><span class="co">### Minimal (default) usage ###</span></span>
<span></span>
<span><span class="co"># Load data</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="st">'path/to/downloaded/Logistic_Dataset_Example.csv'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assuming the first column of data is molecule names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Remove after assigning row names</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Factor the 'class' column (make categorical) </span></span>
<span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">class</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run model.subset, with min and max defining the range of allowed variables</span></span>
<span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/model.subset.log.ordinal.html">model.subset.log.ordinal</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, min <span class="op">=</span> <span class="fl">3</span>, max <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre>
<p>Which returns:</p>
<pre><code>models
                                         formula McFadden R2
1         `class` ~ `X.2.3.` + `NPA_1` + `NPA_3`       0.543
2         `class` ~ `Total` + `NPA_1` + `loc.B5`       0.542
3      `class` ~ `Total` + `diff.1.2` + `loc.B5`       0.537
4   `class` ~ `X.2.3.` + `diff.1.2` + `diff.2.3`       0.532
5  `class` ~ `Dist.2..7.` + `NPA_3` + `diff.1.2`       0.530
6      `class` ~ `Total` + `diff.2.7` + `loc.B5`       0.525
7            `class` ~ `Total` + `B5` + `loc.B5`       0.525
8      `class` ~ `Total` + `diff.2.3` + `loc.B5`       0.524
9         `class` ~ `Total` + `NPA_3` + `loc.B5`       0.523
10         `class` ~ `dip_y` + `NPA_1` + `NPA_3`       0.520</code></pre>
</div>
<div class="section level3">
<h3 id="model-summary">Model Summary<a class="anchor" aria-label="anchor" href="#model-summary"></a>
</h3>
<p>To perform a general summary of the model, users must first manually
run and save the model, as the following functions expect a model
object.</p>
<p><strong>This step is a must in order to manually produce
visualizations with <code><a href="../../reference/ct.plot.html">ct.plot()</a></code> and
<code><a href="../../reference/prob.heatmap.html">prob.heatmap()</a></code></strong></p>
<p>For OMLR - applying MASS::polr()</p>
<pre><code><span><span class="co"># Define model formula</span></span>
<span><span class="va">test.form</span> <span class="op">&lt;-</span> <span class="va">models</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="co"># This example uses the highest ranked model</span></span>
<span></span>
<span><span class="co"># Just for order rename the data</span></span>
<span><span class="va">test.data</span> <span class="op">&lt;-</span> <span class="va">data</span></span>
<span></span>
<span><span class="co"># Define the start argument, see ?MASS::polr() for furthe explanations</span></span>
<span><span class="va">num.of.vars</span> <span class="op">&lt;-</span> <span class="fu">stringi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_count.html" class="external-link">stri_count</a></span><span class="op">(</span><span class="va">test.form</span>, fixed <span class="op">=</span> <span class="st">'+'</span><span class="op">)</span></span>
<span><span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">num.of.vars</span> <span class="op">+</span> <span class="fl">2</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run the model, here named test</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/polr.html" class="external-link">polr</a></span><span class="op">(</span><span class="va">test.form</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">test.data</span>,</span>
<span>                   Hess <span class="op">=</span> <span class="cn">T</span>, start <span class="op">=</span> <span class="va">start</span><span class="op">)</span></span></code></pre>
<p>And for MLR - applying nnet::multinom</p>
<pre><code><span><span class="co"># Define model formula</span></span>
<span><span class="va">test.form</span> <span class="op">&lt;-</span> <span class="va">models</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="co"># Assuming model.subset.logistic() was first run</span></span>
<span></span>
<span><span class="co"># Just for order rename the data</span></span>
<span><span class="va">test.data</span> <span class="op">&lt;-</span> <span class="va">data</span></span>
<span></span>
<span><span class="co"># Run the model, here named test</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu">nnet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nnet/man/multinom.html" class="external-link">multinom</a></span><span class="op">(</span><span class="va">test.form</span>,</span>
<span>                       data <span class="op">=</span> <span class="va">test.data</span>,</span>
<span>                       maxit <span class="op">=</span> <span class="fl">2000</span>, </span>
<span>                       trace <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre>
<p><code>test</code> is a model object, which can now be passed to
<code><a href="../../reference/mod.info.log.ordinal.html">mod.info.log.ordinal()</a></code> or <code><a href="../../reference/mod.info.logistic.html">mod.info.logistic()</a></code>.
The data argument exceptsthe same data loaded for
<code><a href="../../reference/model.subset.log.ordinal.html">model.subset.log.ordinal()</a></code></p>
<pre><code><span><span class="co">### Function Structure ###</span></span>
<span></span>
<span><span class="fu"><a href="../../reference/mod.info.log.ordinal.html">mod.info.log.ordinal</a></span><span class="op">(</span><span class="va">model</span>,</span>
<span>                     <span class="va">data</span><span class="op">)</span></span></code></pre>
<p>The function produces two results directly to the console</p>
<ol style="list-style-type: decimal">
<li>A table with the overall accuracy and the models pseudo
R<sup>2</sup>.</li>
<li>A table with model coefficients.</li>
</ol>
<p>But, more importantly, it saves a classification table (ct) to the
variable it was assigned to (<code>test.info</code> in this example).
This will be used later on.</p>
<pre><code>test.info &lt;- mod.info.log.ordinal(test, data)


|Accuracy |McFadden_R2 |
|:--------|:-----------|
|83.64%   |0.543       |


|         |        Value| Std. Error|       t value|
|:--------|------------:|----------:|-------------:|
|X.2.3.   |   -0.1784354|  0.0002283|     -781.4464|
|NPA_1    |   34.0676906|  0.0002289|   148862.4974|
|NPA_3    | -304.9960103|  0.0000620| -4916229.4879|
|1&amp;#124;2 | -179.6183727|  0.0004239|  -423722.4302|
|2&amp;#124;3 | -174.3768951|  0.6911103|     -252.3141|</code></pre>
</div>
<div class="section level3">
<h3 id="visualizations">Visualizations<a class="anchor" aria-label="anchor" href="#visualizations"></a>
</h3>
<p><strong>A color coded classification table. </strong></p>
<ul>
<li>Percentage within each of the main entries represents the recall (or
its complimenting negative recall).</li>
<li>Percentage in grey boxes represents the part a group takes out of
the entire set.</li>
<li>Percentage in yellow boxes is classification precision.</li>
<li>Percetage in the blue box is the overall model accuracy.</li>
</ul>
<pre><code><span><span class="co"># Produce ct.plot</span></span>
<span><span class="fu"><a href="../../reference/ct.plot.html">ct.plot</a></span><span class="op">(</span><span class="va">test.info</span><span class="op">)</span></span></code></pre>
<p>Which gives:</p>
<center>
<img src="../../reference/figures/ct_plot.png" width="500" height="398">
</center>
<p><strong>A color coded predictions and probabilities table.
</strong></p>
<p>predicted probabilities of each sample to belong in a certain class
and a comparison to the experimental result. Sample name changes color
according to the correctness of prediction:</p>
<ul>
<li>Green colored names are correct classifications</li>
<li>Orange colored names are wrong classifications, where the second
highest probability is the correct one</li>
<li>Red colored names are wrong</li>
</ul>
<pre><code><span><span class="co"># Produce probabilities heatmap</span></span>
<span><span class="fu"><a href="../../reference/prob.heatmap.html">prob.heatmap</a></span><span class="op">(</span><span class="va">test</span>, <span class="va">data</span><span class="op">)</span></span></code></pre>
Which gives
<center>
<img src="../../reference/figures/HM_plot.png" width="583" height="634">
</center>
</div>
<div class="section level3">
<h3 id="model-report-1">Model Report<a class="anchor" aria-label="anchor" href="#model-report-1"></a>
</h3>
<p><strong>Designed as the main function for classification modeling
purposes.</strong></p>
<p>Produce a complete report for a data set (csv file).</p>
<p>This is a wrapper function that uses all of the functions above under
the hood, but also includes a smallest-group-size-fold CV, as well as a
LOOCV. Produces visualizations and model summary automatically. Defaults
to reporting the top ranked model, which is changeable with
<code>model.number</code>.</p>
<pre><code><span><span class="co">### Function Structure ###</span></span>
<span><span class="fu"><a href="../../reference/model.report.log.ordinal.html">model.report.log.ordinal</a></span><span class="op">(</span><span class="va">dataset</span>,</span>
<span>                         min <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                         max <span class="op">=</span> <span class="op">(</span><span class="va">min</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                         model.number <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre>
<p>Normal usgae, for our example file(using min = max = 2)</p>
<pre><code><span><span class="fu"><a href="../../reference/model.report.log.ordinal.html">model.report.log.ordinal</a></span><span class="op">(</span><span class="st">'path/to/Logistic_Dataset_Example.csv'</span>,</span>
<span>                         min <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                         max <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre>
<p>Produces</p>
<pre><code>Logistic_Dataset_Example

|formula                          | McFadden R2|
|:--------------------------------|-----------:|
|`class` ~ `Total` + `loc.B5`     |       0.490|
|`class` ~ `Total` + `Dist.2..3.` |       0.467|
|`class` ~ `X.2.3.` + `Total`     |       0.447|
|`class` ~ `Total` + `NPA_3`      |       0.447|
|`class` ~ `Total` + `L`          |       0.443|
|`class` ~ `Dist.2..7.` + `NPA_3` |       0.419|
|`class` ~ `X.2.3.` + `NPA_3`     |       0.416|
|`class` ~ `X.2.7.` + `NPA_3`     |       0.406|
|`class` ~ `NPA_3` + `diff.2.7`   |       0.404|
|`class` ~ `dip_y` + `NPA_3`      |       0.402|

  Leave-one-out Cross Validation - single iteration
      

|actual |  1|  2|  3|    |actual |  1|  2|  3|
|:------|--:|--:|--:|:---|:------|--:|--:|--:|
|1      | 18|  4|  0|*** |1      | 18|  4|  0|
|2      |  1| 19|  2|*** |2      |  1| 19|  2|
|3      |  0|  4|  7|*** |3      |  0|  4|  7|


|over.all.accuracy |best |worst |
|:-----------------|:----|:-----|
|80                |80   |80    |

  Smallest-group-fold Cross Validation (100 iterations)
  
  Classification tables for best (left) and worst (right) iterations. 
      

|actual |  1|  2|  3|    |actual |  1|  2|  3|
|:------|--:|--:|--:|:---|:------|--:|--:|--:|
|1      | 19|  3|  0|*** |1      | 18|  4|  0|
|2      |  1| 19|  2|*** |2      |  2| 18|  2|
|3      |  0|  4|  7|*** |3      |  0|  4|  7|


|over.all.accuracy |best  |worst |
|:-----------------|:-----|:-----|
|79.42             |81.82 |78.18 |

  Model Summary
      

|Accuracy |McFadden_R2 |
|:--------|:-----------|
|80%      |0.49        |


|         |      Value| Std. Error|   t value|
|:--------|----------:|----------:|---------:|
|Total    |  2.5067944|  0.4980471|  5.033248|
|loc.B5   | -0.4868867|  0.1408152| -3.457629|
|1&amp;#124;2 |  5.5853729|  1.4951692|  3.735612|
|2&amp;#124;3 |  9.4065888|  1.8281335|  5.145461|</code></pre>
<p>As well as the plots in visualization, side by side (Now presented
one below the other)</p>
<center>
<img src="../../reference/figures/ct_2_plot.png" width="500" height="398">
</center>
<center>
<img src="../../reference/figures/HM_2_plot.png" width="583" height="634">
</center>
</div>
<div class="section level3">
<h3 id="dealing-with-unbalanced-data-sets">Dealing with Unbalanced Data Sets<a class="anchor" aria-label="anchor" href="#dealing-with-unbalanced-data-sets"></a>
</h3>
<p>moleculaR also includes a cosine similarity based sampling function,
that allows users to create well distributed subsets of classes.</p>
<ol style="list-style-type: decimal">
<li><p>For each class, a mean vector is computed and taken as the
representative vector of that class.</p></li>
<li><p>For each sample in the set (a vector of features) the cosine of
the angle between it and all representative vectors is computed. This
step yields the similarity of that sample with each of the classes,
including its own class. A value in the range of -1 to 1 is given as an
indication of how well correlated the different entries of each vector
with that of the representative (1 being completely correlated and -1
being anti-correlated).</p></li>
<li><p>Depending on the requested number of samples (N) to be taken and
the class compared with, the range is equally divided to N-1 segments.
The closest sample to each divider is sampled. This creates a
well-distributed representative sample of the set.</p></li>
</ol>
<p>For example, in the following illustration, a sample of 6
representatives is taken from a set of observations. The similarity
measurement can be either that of these data points with their own
class, or with another class. The maximal and minimal similarity
observations are always sampled, and the distance of all points from
each divider (red lines) is measured, with the minimal value
observations sampled (highlighted).</p>
<center>
<img src="../../reference/figures/simi_sampler.png" width="608" height="148">
</center>
<p>As an example, consider balancing the data set we have, such that we
will end with 11 samples of each group (size of the smallest group, also
the default setting)</p>
<pre><code><span><span class="co">### Function Structure ###</span></span>
<span><span class="fu"><a href="../../reference/simi.sampler.html">simi.sampler</a></span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">class</span>,</span>
<span>  compare.with <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  sample.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">class</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
<p>The function returns a vector of row numbers that represent the
sampled subset.</p>
<pre><code><span><span class="co"># Load data</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="st">'path/to/downloaded/Logistic_Dataset_Example.csv'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assuming the first column of data is molecule names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Remove after assigning row names</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Factor the 'class' column (make categorical) </span></span>
<span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">class</span><span class="op">)</span></span></code></pre>
<p>As a start, we can sample out based on similarity of each group with
itself (default, defined by <code>compare.with = 0</code>), with a
sample size based on the smallest group (11).</p>
<ul>
<li>Change <code>class</code> to any one of the classes, and it will
sample it.</li>
<li>Change <code>compare.with</code> to any one the classes, and will
perform based on similarity to that class.</li>
</ul>
<p>A nice plot is also available.</p>
<pre><code>simi.sampler(data = data, class = 1, plot = T)

# Gives the vector of samples as output (row numbers to be sampled)

[1]  1  7  8 12 13 15 18 19 20 21 22</code></pre>
<center>
<img src="../../reference/figures/simi_sampler_2.png" width="623" height="350">
</center>
<p>Note how group one is now down to 11 points, while still spread
across the similarity measure range.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Shahar Barkai.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
